Datafaser Design
----------------

Use simplest possible descriptions to fulfill goals such as information system setups.

Datafaser uses descriptions specific for a chosen purpose to enrich given data step by step.
The outcome of each step is verified by a description of expected outcome.
Finally that data can be used to generate files and execute operations.

## Order of operations

Datafaser needs one thing to start: a run plan. It defines the steps to take:

 - sources and formats of data and schemas to verify it
 - sources and formats of templates used to enrich the data and generate results
 - data enrichment steps and schemas to verify their output
 - result generation steps and checks for their output
 - operations to execute with the results and expectations for their output
 - results of all steps can be reported as files.

 1. Data loader loads the run plan
    - from a single file in YAML or JSON format.
 2. Datafaser uses schema checker (jsonschema by default) to verify the run plan format.
 3. Datafaser executes steps as specified in the run plan.
  
### Data Loader

Data loader merges data structures from different data source loaders.
Recursive file loader is the first implementation.

#### Recursive File Loader

Takes a map of file name patterns to stream parsers.
Traverses given directories. Returns a map of each directory and filename as key and its contents as value.
Uses stream parsers with matching file name patterns to read file contents.

### Validator

Data structures loaded or generated by generator templates are validated against associated schemas.

First implementation only supports jsonschema. Schema data can be loaded from different data formats though.

### Reporter

Resulting data, file contents, and explanations of execution of each step can be stored in separate files regardless of their outcome.

#### Types

Custom types used in schemas can be defined as data.

### Template Engine

Template engine is used for several purposes:

 - generate results from templates and data
 - generate data from templates and data (by generating text following a data format)
 - generate validity reports about data

First implementation uses jinja2.

Template operations should be constrained to a subset common to engines in many different languages.

### Result Checker

Produced results can be checked with simplish result format specifiers.

### Operation Runner

External programs can be run with parameters filled in from data.

## Safety Restrictions

### Access only files under current working directory

All file references are ensured to stay within current working directory.
External programs must be found in environment PATH.

### Separate resource downloader to ensure offline operation

Offline mode requires that all network resources are stored locally.
A download operation can be run to take care of that.

